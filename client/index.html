<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Lokaverkefni</title>
  <link rel="stylesheet" href="./client/css/styles.css">
</head>

<body>
  <div class="gameContainer">
    <div class="sideBar">
      <div class="Headerinn" id="headTitle"></div>
      <img class="heads" id="playerHeads">
      <div id="grad1">
        <div id="bar">
          <div id ="status"></div>
        </div>
      </div>
    </div>
    <canvas id="myCanvas" width="640" height="640" style="border: 1px solid black;"> Sorry, but your browser does not support the HTML5 canvas tag.</canvas>
</div>
        
   
  <div class="firstViewContainer" id="videoContainerinn">
      <video class="myVideo" src="/client/videos/frontPic.mp4" autoplay=""></video>
      <div class="players">
        <h2 id ="one"></h2>
        <h2 id ="two"></h2>
        <h2 id ="three"></h2>
      </div>
    </div>
    <video id="myVideoBackground" src="/client/videos/frontPic.mp4" autoplay=""></video>
      
    </div>

  <!-- ------------------HTML END SCRIPTS START --------------------------------------->

  <!-- We need this to communicate using socket.io from client side -->
  <script src="/socket.io/socket.io.js"></script>
  <script> 
    const g_canvas = document.getElementById("myCanvas");
    const g_ctx = g_canvas.getContext("2d");
    const socket = io();// establish our communication
    let g_readyForNextRound = false;
    let g_steps=[];
  </script>
  
  <!-- include all client game logic such as drawing the map waiting looby etc -->
  <script src="./client/js/imagesPreload.js"></script>
  <script src="./client/js/utils.js"></script>
  <script src="./client/js/playerMovement.js"></script>
  <script src="./client/js/handleMouse.js"></script>
  <script src="./client/js/Sprite.js"></script>
  <script src="./client/js/main.js"></script>
  <script src ="./client/js/firstView.js"></script>
  <script src="./client/js/progressBar.js"></script>
  <script src="./client/js/staminaScores.js"></script>
  <script src="./client/js/animation.js"></script>


 
  <!-- Combine all the game logic into a client side game -->
  <script>
    /* Define what happens when a socket manages to connect to our server */
    socket.on('connect', function() {
      // in here we can pass our socket.id to the functions that need it
      
      /* Next game round is send to us every x-seconds here we recive the map
      and call the necessary functions needed to draw the map based off 
      the data recived */
      drawPlayers();
      socket.on('NextGameRound', (data)=> {
        allPlayerReady(data);
        drawMapViaTiles(data, socket.id);
        // check if game over ?
      });

      socket.on('roundstart', ()=> {
        player = getPlayer();
        
        setStamina(player);
        startProgressBar();
        g_readyForNextRound=false;
        moveMen(0,5);
        setTimeout(() => {
          socket.emit('clientinput',{ steps:g_steps, powerUp:false});
          g_steps = [];
        }, 5000);
      });

      /* client will send to the Server every 3 seconds if he is ready to for the next round
         the idea is that different clients take different time to render the game, so we will
         wait for all clients to render the map and the animations and then play next round */
      setInterval(() => { socket.emit('clientreadyfornextround',g_readyForNextRound)},3000);
    });
  </script>

</body>
</html>